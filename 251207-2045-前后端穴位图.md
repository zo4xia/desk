# ä¸œé‡Œæ‘æ™ºèƒ½å¯¼æ¸¸ç³»ç»Ÿ - å‰åç«¯ç©´ä½å›¾ï¼ˆæ¥å£æ•°æ®æ‰‹å†Œï¼‰

> ç”Ÿæˆæ—¶é—´: 2025-12-07 20:45
> ç”¨é€”: å‰ç«¯é¡µé¢ â†” åç«¯API å¯¹æ¥é€ŸæŸ¥

---

## ä¸€ã€æ¥å£æ€»è§ˆ

| åˆ†ç±» | æ¥å£æ•° | ç”¨é€” |
|-----|-------|------|
| æ™¯ç‚¹ | 2 | åˆ—è¡¨+è¯¦æƒ… |
| äººç‰© | 2 | åˆ—è¡¨+è¯¦æƒ… |
| å…¬å‘Š | 1 | åŠ¨æ€åˆ—è¡¨ |
| è®¤è¯ | 2 | å‘é€éªŒè¯ç +ç™»å½• |
| ç”¨æˆ· | 1 | ä¸ªäººèµ„æ–™ |
| æ‰“å¡ | 2 | æäº¤+è®°å½• |
| **åˆè®¡** | **10** | å‰å°API |

---

## äºŒã€ç©´ä½å›¾è¯¦è§£

### 2.1 æ™¯ç‚¹API

#### GET /api/spots
**ç”¨é€”**: è·å–æ™¯ç‚¹åˆ—è¡¨  
**å¯¹åº”é¡µé¢**: `SpotListPage.tsx`  
**è§¦å‘æ—¶æœº**: é¡µé¢åŠ è½½ã€ä¸‹æ‹‰åˆ·æ–°

| è¯·æ±‚å‚æ•° | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|---------|------|------|------|
| category | string | å¦ | åˆ†ç±»ï¼šred-culture/nature-spots |
| type | string | å¦ | ç±»å‹ï¼šred/nature |
| page | number | å¦ | é¡µç ï¼Œé»˜è®¤1 |
| limit | number | å¦ | æ¯é¡µæ¡æ•°ï¼Œé»˜è®¤20 |

**å“åº”æ•°æ®**:
```json
{
  "success": true,
  "data": [
    {
      "id": "1",
      "name": "ä¸œé‡Œå¤æ¨Ÿæ ‘",
      "type": "nature",
      "category": "nature-spots",
      "desc": "300å¹´æ ‘é¾„çš„å¤æ¨Ÿæ ‘",
      "location": "æ‘å£å¹¿åœºä¸œä¾§",
      "image": "",
      "audioUrl": ""
    }
  ],
  "pagination": { "page": 1, "limit": 20, "total": 4 }
}
```

---

#### GET /api/spots/:id
**ç”¨é€”**: è·å–æ™¯ç‚¹è¯¦æƒ…  
**å¯¹åº”é¡µé¢**: `SpotDetailPage.tsx`  
**è§¦å‘æ—¶æœº**: ä»åˆ—è¡¨ç‚¹å‡»è¿›å…¥è¯¦æƒ…

| è·¯å¾„å‚æ•° | ç±»å‹ | è¯´æ˜ |
|---------|------|------|
| id | string | æ™¯ç‚¹ID |

**å“åº”æ•°æ®**: åŒä¸Šå•ä¸ªæ™¯ç‚¹å¯¹è±¡

---

### 2.2 äººç‰©API

#### GET /api/figures
**ç”¨é€”**: è·å–äººç‰©åˆ—è¡¨  
**å¯¹åº”é¡µé¢**: `SpotListPage.tsx`ï¼ˆå¤ç”¨ï¼‰  
**è§¦å‘æ—¶æœº**: ä»äººç‰©åˆ†ç±»è¿›å…¥

| è¯·æ±‚å‚æ•° | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|---------|------|------|------|
| category | string | å¦ | åˆ†ç±»ï¼šmartyrs/sages/students/contemporary |
| type | string | å¦ | ç±»å‹ï¼šmartyr/sage/student/contemporary |
| year | number | å¦ | å…¥å­¦å¹´ä»½ï¼ˆä»…å¤§å­¦ç”Ÿï¼‰ |
| page | number | å¦ | é¡µç  |
| limit | number | å¦ | æ¯é¡µæ¡æ•° |

**å“åº”æ•°æ®**:
```json
{
  "success": true,
  "data": [
    {
      "id": "1",
      "name": "å¼ ä¼Ÿçƒˆå£«",
      "type": "martyr",
      "category": "martyrs",
      "birth": "1920",
      "death": "1945",
      "achievement": "æŠ—æ—¥æˆ˜äº‰ä¸­è‹±å‹‡ç‰ºç‰²",
      "story": "åœ¨æŠ—æ—¥æˆ˜äº‰ä¸­..."
    }
  ],
  "pagination": { "page": 1, "limit": 20, "total": 5 }
}
```

---

#### GET /api/figures/:id
**ç”¨é€”**: è·å–äººç‰©è¯¦æƒ…  
**å¯¹åº”é¡µé¢**: `SpotDetailPage.tsx`ï¼ˆå¤ç”¨ï¼‰  
**è§¦å‘æ—¶æœº**: ä»åˆ—è¡¨ç‚¹å‡»è¿›å…¥

---

### 2.3 å…¬å‘ŠAPI

#### GET /api/announcements
**ç”¨é€”**: è·å–å…¬å‘Š/åŠ¨æ€åˆ—è¡¨  
**å¯¹åº”é¡µé¢**: `AnnouncementPage.tsx`  
**è§¦å‘æ—¶æœº**: é¡µé¢åŠ è½½ã€ä¸‹æ‹‰åˆ·æ–°

| è¯·æ±‚å‚æ•° | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|---------|------|------|------|
| type | string | å¦ | ç±»å‹ï¼švideo/activity/notice |
| page | number | å¦ | é¡µç  |
| limit | number | å¦ | æ¯é¡µæ¡æ•° |

**å“åº”æ•°æ®**:
```json
{
  "success": true,
  "data": [
    {
      "id": "1",
      "type": "video",
      "title": "ä¸œé‡Œæ‘æ˜¥èŠ‚æ°‘ä¿—æ´»åŠ¨ç²¾å½©å›é¡¾",
      "summary": "è®°å½•äº†ä»Šå¹´æ˜¥èŠ‚æœŸé—´çš„æ°‘ä¿—æ´»åŠ¨...",
      "date": "2025-02-15",
      "source": "ä¸œé‡Œæ‘å®˜æ–¹å·"
    }
  ],
  "pagination": { "page": 1, "limit": 20, "total": 3 }
}
```

---

### 2.4 è®¤è¯API

#### POST /api/auth/send-code
**ç”¨é€”**: å‘é€çŸ­ä¿¡éªŒè¯ç   
**å¯¹åº”é¡µé¢**: `LoginPage.tsx`  
**è§¦å‘æ—¶æœº**: ç‚¹å‡»"è·å–éªŒè¯ç "æŒ‰é’®

| è¯·æ±‚å‚æ•° | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|---------|------|------|------|
| phone | string | æ˜¯ | æ‰‹æœºå·ï¼ˆ11ä½ï¼‰ |

**å“åº”æ•°æ®**:
```json
{ "success": true, "message": "éªŒè¯ç å·²å‘é€" }
```

**æµ‹è¯•éªŒè¯ç **: `123456`ï¼ˆå›ºå®šï¼‰

---

#### POST /api/auth/login
**ç”¨é€”**: ç”¨æˆ·ç™»å½•  
**å¯¹åº”é¡µé¢**: `LoginPage.tsx`  
**è§¦å‘æ—¶æœº**: ç‚¹å‡»"ç™»å½•"æŒ‰é’®

| è¯·æ±‚å‚æ•° | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|---------|------|------|------|
| phone | string | æ˜¯ | æ‰‹æœºå· |
| code | string | æ˜¯ | éªŒè¯ç  |

**å“åº”æ•°æ®**:
```json
{
  "success": true,
  "data": {
    "user": {
      "id": "user-xxx",
      "phone": "13800138000",
      "nickname": "æ¸¸å®¢8000",
      "avatar": "ğŸ˜Š",
      "checkInCount": 0
    },
    "token": "token-xxx-xxx"
  },
  "message": "ç™»å½•æˆåŠŸ"
}
```

**å‰ç«¯å­˜å‚¨**: `localStorage.setItem('token', data.token)`

---

### 2.5 ç”¨æˆ·API

#### GET /api/user/profile
**ç”¨é€”**: è·å–å½“å‰ç”¨æˆ·èµ„æ–™  
**å¯¹åº”é¡µé¢**: `UserProfilePage.tsx`  
**è§¦å‘æ—¶æœº**: è¿›å…¥ä¸ªäººä¸­å¿ƒé¡µé¢

| è¯·æ±‚å¤´ | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|-------|------|------|------|
| Authorization | string | æ˜¯ | `Bearer {token}` |

**å“åº”æ•°æ®**:
```json
{
  "success": true,
  "data": {
    "id": "user-xxx",
    "phone": "13800138000",
    "nickname": "æ¸¸å®¢8000",
    "avatar": "ğŸ˜Š",
    "checkInCount": 3,
    "recentCheckins": [...]
  }
}
```

---

### 2.6 æ‰“å¡API

#### POST /api/checkin
**ç”¨é€”**: æäº¤æ™¯ç‚¹æ‰“å¡  
**å¯¹åº”é¡µé¢**: `CheckInPage.tsx`  
**è§¦å‘æ—¶æœº**: ç‚¹å‡»"ç«‹å³æ‰“å¡"æŒ‰é’®

| è¯·æ±‚å¤´ | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|-------|------|------|------|
| Authorization | string | æ˜¯ | `Bearer {token}` |

| è¯·æ±‚å‚æ•° | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|---------|------|------|------|
| spotId | string | æ˜¯ | æ™¯ç‚¹ID |
| spotName | string | å¦ | æ™¯ç‚¹åç§° |

**å“åº”æ•°æ®**:
```json
{
  "success": true,
  "data": {
    "id": "checkin-xxx",
    "spotId": "1",
    "spotName": "ä¸œé‡Œå¤æ¨Ÿæ ‘",
    "date": "2025-12-07",
    "time": "2025-12-07T12:00:00.000Z"
  },
  "message": "æ‰“å¡æˆåŠŸ"
}
```

---

#### GET /api/checkin/records
**ç”¨é€”**: è·å–ç”¨æˆ·æ‰“å¡è®°å½•  
**å¯¹åº”é¡µé¢**: `UserProfilePage.tsx`  
**è§¦å‘æ—¶æœº**: æŸ¥çœ‹æ‰“å¡å†å²

| è¯·æ±‚å¤´ | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|-------|------|------|------|
| Authorization | string | æ˜¯ | `Bearer {token}` |

**å“åº”æ•°æ®**:
```json
{
  "success": true,
  "data": [
    { "id": "checkin-1", "spotId": "1", "spotName": "ä¸œé‡Œå¤æ¨Ÿæ ‘", "date": "2025-12-07" }
  ]
}
```

---

## ä¸‰ã€é¡µé¢ â†’ API æ˜ å°„è¡¨

| é¡µé¢æ–‡ä»¶ | è°ƒç”¨çš„API | å¤‡æ³¨ |
|---------|----------|------|
| `HomePage.tsx` | æ—  | é™æ€å…¥å£ |
| `LoginPage.tsx` | `/api/auth/send-code`, `/api/auth/login` | ç™»å½•æµç¨‹ |
| `CategoryPage.tsx` | æ—  | ç¡¬ç¼–ç åˆ†ç±» |
| `SpotListPage.tsx` | `/api/spots`, `/api/figures` | æ ¹æ®typeåŒºåˆ† |
| `SpotDetailPage.tsx` | `/api/spots/:id`, `/api/figures/:id` | è¯¦æƒ…é¡µ |
| `FiguresCategoryPage.tsx` | æ—  | ç¡¬ç¼–ç åˆ†ç±» |
| `AnnouncementPage.tsx` | `/api/announcements` | å…¬å‘Šåˆ—è¡¨ |
| `CheckInPage.tsx` | `/api/checkin` | æ‰“å¡åŠŸèƒ½ |
| `UserProfilePage.tsx` | `/api/user/profile`, `/api/checkin/records` | ä¸ªäººä¸­å¿ƒ |
| `ChatPage.tsx` | Agentç³»ç»Ÿ | å¾…å¯¹æ¥ |

---

## å››ã€é€šç”¨çº¦å®š

### è¯·æ±‚æ ¼å¼
- Content-Type: `application/json`
- è®¤è¯å¤´: `Authorization: Bearer {token}`

### å“åº”æ ¼å¼
```json
{
  "success": true/false,
  "data": {...},           // æˆåŠŸæ—¶è¿”å›
  "error": "é”™è¯¯ä¿¡æ¯",      // å¤±è´¥æ—¶è¿”å›
  "message": "æç¤ºä¿¡æ¯",    // å¯é€‰
  "pagination": {...}       // åˆ—è¡¨æ¥å£
}
```

### é”™è¯¯ç 
| HTTPçŠ¶æ€ç  | å«ä¹‰ |
|-----------|------|
| 200 | æˆåŠŸ |
| 400 | å‚æ•°é”™è¯¯ |
| 401 | æœªç™»å½•/tokenæ— æ•ˆ |
| 404 | èµ„æºä¸å­˜åœ¨ |
| 500 | æœåŠ¡å™¨é”™è¯¯ |

---

## äº”ã€åç«¯å¯åŠ¨

```bash
# å¯åŠ¨åç«¯æœåŠ¡ï¼ˆç«¯å£3001ï¼‰
node server.js

# å¯åŠ¨å‰ç«¯æœåŠ¡ï¼ˆç«¯å£3000ï¼‰
npm run dev
```

**æµ‹è¯•è´¦å·**: ä»»æ„æ‰‹æœºå· + éªŒè¯ç  `123456`

---

## å…­ã€å¾…åŠé¡¹

- [ ] å‰ç«¯é¡µé¢å¯¹æ¥APIï¼ˆæ›¿æ¢mockæ•°æ®ï¼‰
- [ ] ChatPageå¯¹æ¥Agentç³»ç»Ÿ
- [ ] å›¾ç‰‡ä¸Šä¼ åŠŸèƒ½
- [ ] éŸ³é¢‘æ’­æ”¾åŠŸèƒ½
